<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:avalonia="https://github.com/projektanker/icons.avalonia"
             xmlns:models="clr-namespace:R2CSharp.Lib.Models"
             x:Class="R2CSharp.Lib.Views.RebootOptionPageView"
             x:DataType="models:PageConfiguration">
    
    <UserControl.Resources>
          <DataTemplate x:Key="OptionButtonTemplate" x:DataType="models:RebootOption">
              <Border CornerRadius="150" Background="Transparent" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Margin="5">
                  <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                      <Button Width="250" Height="250" CornerRadius="30"
                              Command="{Binding Command}"
                              CommandParameter="{Binding}"
                              Name="OptionButton"
                              Focusable="False"
                              IsTabStop="False">
                          <!-- ReSharper disable Xaml.PossibleNullReferenceException -->
                          <Button.Styles>
                               <Style Selector="Button">
                                  <Setter Property="Background" Value="{StaticResource ButtonDefaultBackground}" />
                                  <Setter Property="Foreground" Value="{StaticResource PrimaryText}" />
                                  <Setter Property="BorderBrush" Value="Transparent" />
                                  <Setter Property="BorderThickness" Value="0" />
                                  <Setter Property="CornerRadius" Value="4" />
                              </Style>
                              <Style Selector="Button:hover">
                                  <Setter Property="Background" Value="{StaticResource ButtonHoverBackground}" />
                                  <Setter Property="BorderBrush" Value="{StaticResource ButtonHoverBorder}" />
                                  <Setter Property="BorderThickness" Value="2" />
                              </Style>
                              <Style Selector="Button.selected">
                                  <Setter Property="BorderThickness" Value="4" />
                                  <Setter Property="BorderBrush" Value="{Binding $parent[UserControl].((models:PageConfiguration)DataContext).ThemeColor}" />
                                  <Setter Property="Background" Value="{StaticResource ButtonSelectedBackground}" />
                              </Style>
                              <Style Selector="Button.pressed">
                                  <Setter Property="Background" Value="{StaticResource ButtonPressedBackground}" />
                                  <Setter Property="BorderBrush" Value="{StaticResource ButtonPressedBorder}" />
                              </Style>
                          </Button.Styles>
                          <StackPanel Orientation="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center">
                              <Image Source="{Binding Icon}"
                                     Width="200" Height="200"
                                     IsVisible="{Binding Icon, Converter={x:Static ObjectConverters.IsNotNull}}" />
                              <avalonia:Icon Value="{Binding FallbackIcon}"
                                             FontSize="130"
                                             IsVisible="{Binding Icon, Converter={x:Static ObjectConverters.IsNull}}"
                                             Foreground="{Binding $parent[UserControl].((models:PageConfiguration)DataContext).ThemeColor}" />
                          </StackPanel>
                          <!-- ReSharper restore Xaml.PossibleNullReferenceException -->
                      </Button>
                      <TextBlock Text="{Binding Name}"
                                 HorizontalAlignment="Center"
                                 VerticalAlignment="Center"
                                 TextAlignment="Center"
                                 TextWrapping="Wrap"
                                 FontSize="30"
                                 MaxWidth="250"
                                 Margin="0,15,0,0"
                                 Foreground="{StaticResource PrimaryText}"
                                 Height="100" />
                  </StackPanel>
              </Border>
          </DataTemplate>
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Button:pressed">
            <Setter Property="Background" Value="{StaticResource ButtonPressedBackground}" />
            <Setter Property="BorderBrush" Value="{StaticResource ButtonPressedBorder}" />
        </Style>
    </UserControl.Styles>
    
         <Viewbox Stretch="Uniform">
         <Border Background="{StaticResource PageContainerBackground}" CornerRadius="25" Padding="20" Margin="30,10"  MinWidth="1650" MinHeight="850">
             <Grid RowDefinitions="Auto,*">
                 
                 <!-- Header -->
                 <Grid Margin="0,0,0,15">
                     <avalonia:Icon Value="fa-solid fa-location-arrow" 
                                    Margin="20,0,15,15" 
                                    Foreground="{StaticResource PrimaryText}"
                                    FontSize="50"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Bottom"/>
                     <TextBlock Text="{Binding SectionName}"
                                FontSize="35"
                                FontWeight="SemiBold"
                                Foreground="{StaticResource PrimaryText}"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Left"
                                Margin="100,0,0,20"/>
                 </Grid>
                 
                 <!-- Divider -->
                 <Border Height="1" Background="{StaticResource PrimaryText}" Margin="0,0,0,20" Grid.Row="0" VerticalAlignment="Bottom" />
                 
                 <!-- Content Area -->
                 <Grid Grid.Row="1" RowDefinitions="*,*">
                     
                      <!-- Single Row Layout (<=4 buttons) - Centered -->
                      <Grid Grid.Row="0" Grid.RowSpan="2" 
                            IsVisible="{Binding IsSingleRow}" RowDefinitions="*,Auto,*">
                          <ItemsControl ItemsSource="{Binding Options}"
                                        Grid.Row="1"
                                        HorizontalAlignment="Stretch">
                               <ItemsControl.ItemsPanel>
                                   <ItemsPanelTemplate>
                                       <UniformGrid Columns="{Binding ActualColumns}" Rows="1" />
                                   </ItemsPanelTemplate>
                               </ItemsControl.ItemsPanel>
                               <ItemsControl.ItemTemplate>
                                   <StaticResource ResourceKey="OptionButtonTemplate" />
                               </ItemsControl.ItemTemplate>
                           </ItemsControl>
                        </Grid>
                      
                      <!-- Multi Row Layout (>=5 buttons) - Top Aligned -->
                      <ItemsControl ItemsSource="{Binding Options}"
                                    Grid.Row="0" Grid.RowSpan="2"
                                    VerticalAlignment="Top"
                                    Margin="0,35,0,0"
                                    IsVisible="{Binding !IsSingleRow}">
                          <ItemsControl.ItemsPanel>
                              <ItemsPanelTemplate>
                                  <UniformGrid Columns="{Binding ActualColumns}" 
                                               Rows="{Binding ActualRows}" />
                              </ItemsPanelTemplate>
                          </ItemsControl.ItemsPanel>
                          <ItemsControl.ItemTemplate>
                              <StaticResource ResourceKey="OptionButtonTemplate" />
                          </ItemsControl.ItemTemplate>
                      </ItemsControl>
                     
                     <!-- Empty State -->
                     <TextBlock Grid.Row="0" Text="{Binding EmptyMessage}"
                                Foreground="{StaticResource SecondaryText}"
                                FontStyle="Italic"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                TextAlignment="Center"
                                FontSize="16"
                                IsVisible="{Binding Options.Count, Converter={x:Static ObjectConverters.IsNull}}" />
                 </Grid>
             </Grid>
         </Border>
     </Viewbox>
</UserControl> 